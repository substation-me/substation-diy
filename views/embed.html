<!doctype html>
<html class="no-js" lang="">
<head>

  <!-- Basic Page Needs
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>{{copy.title}}</title>
  <meta name="description" content="{{copy.description}}">
  <meta name="author" content="@jessevondoom">

  <!-- Mobile Specific Metas
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- CSS
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link rel="stylesheet" type="text/css" href="/normalize.css">
  <link rel="stylesheet" type="text/css" href="/skeleton.css">
  <link rel="stylesheet" type="text/css" href="/embed.css">

  <!-- Favicon
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link rel="icon" type="image/png" href="https://cdn.glitch.com/9f35da85-6537-4c08-8c75-92364571d412%2Flogo-bw-email.png?v=1579197689402">
  <script src="https://cdn.jsdelivr.net/gh/substationhq/lodge@0.2.2/source/lodge.js" crossorigin="anonymous"></script>
</head>
<body>

  <!-- Widget 
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->

    <div class="vv-embed container">
        
      <div class="subscription-widget">
        <div class="checkout-button">
          <input type="number" id="input-price" value="{{braintree.minimumCost}}">
          <button id="checkout">Subscribe: $<span id="checkout-price">{{braintree.minimumCost}}</span>/mo</button>
        </div>
        {{#sandboxed}}
        <div class="sandbox-mode">
          <b>SANDBOX MODE.</b> <a href="https://developers.braintreepayments.com/guides/credit-cards/testing-go-live/node" target="_blank">Test cards</a> only, no real currency.
        </div>
        {{/sandboxed}}
        <div class="fine-print">
          By signing up you are agreeing to recurring payments. You are free to <a href="#" id="cancelLink">cancel</a> any time.
        </div>
      </div>

    </div>

  
<!-- Scripts
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <script nonce="{{scriptNonce}}">
    var vv = window.lodge;
    // set our options for the checkout module
    var checkoutOptions = {
      braintree: '{{{braintree.clientToken}}}',
      recurring:true,
      endpoint:'/subscribe',
      successMsg:'Success. Your monthly payments are set up, and you should see a confirmation email shortly.',
      errorMsg:'There was a problem. Please check your credit card information and try again.',
      amount:{{braintree.minimumCost}}
    };
    
    // don't set up any events until Lodge says we're ready
    vv.events.add(vv,'ready', function(e) {
      // first just set the loading screen
      vv.overlay.setLoading('<svg id="substation-loading" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 63 54.500000" shape-rendering="geometricPrecision" text-rendering="geometricPrecision"><style><![CDATA[#e8bu6x54hi373_to {animation: e8bu6x54hi373_to__to 3500ms linear infinite normal forwards}@keyframes e8bu6x54hi373_to__to { 0% {transform: translate(0.070095px,1px)} 28.571429% {transform: translate(0.070095px,1px)} 37.428571% {transform: translate(0.070095px,1px)} 48.571429% {transform: translate(-15.929905px,1px)} 59.142857% {transform: translate(-15.929905px,1px)} 70% {transform: translate(0.070095px,1px)} 100% {transform: translate(0.070095px,1px)} }#e8bu6x54hi374_to {animation: e8bu6x54hi374_to__to 3500ms linear infinite normal forwards}@keyframes e8bu6x54hi374_to__to { 0% {transform: translate(0px,1px)} 28.571429% {transform: translate(0px,1px)} 37.428571% {transform: translate(-16px,1px)} 70% {transform: translate(-16px,1px)} 82.571429% {transform: translate(0px,1px)} 100% {transform: translate(0px,1px)} }#e8bu6x54hi374 {animation: e8bu6x54hi374_c_o 3500ms linear infinite normal forwards}@keyframes e8bu6x54hi374_c_o { 0% {opacity: 1} 37.142857% {opacity: 1} 37.428571% {opacity: 0} 69.714286% {opacity: 0} 70% {opacity: 1} 100% {opacity: 1} }]]></style><path id="e8bu6x54hi372" d="M1.090240,12.929700C0.750397,12.777300,0.580475,12.519500,0.580475,12.156200C0.580475,12.039100,0.603912,11.927700,0.650787,11.822300L5.590240,0.572266C5.625400,0.490234,5.666410,0.419922,5.713290,0.361328C5.771880,0.291016,5.836330,0.238281,5.906650,0.203125C5.976960,0.156250,6.047270,0.121094,6.117580,0.097656C6.199620,0.074219,6.281650,0.062500,6.363680,0.062500C6.480870,0.062500,6.592190,0.085938,6.697660,0.132812C7.037510,0.285156,7.207430,0.542969,7.207430,0.906250C7.207430,0.953125,7.201570,0.994141,7.189850,1.029300C7.189850,1.064450,7.183990,1.099610,7.172270,1.134770C7.160550,1.169920,7.148830,1.205080,7.137120,1.240230L2.197660,12.490200C2.162510,12.572300,2.115630,12.648400,2.057040,12.718800C2.010160,12.777300,1.951570,12.830100,1.881260,12.877000C1.810940,12.912100,1.734770,12.941400,1.652740,12.964800C1.582430,12.988300,1.506260,13,1.424220,13C1.307040,13,1.195710,12.976600,1.090240,12.929700Z" transform="matrix(4 0 0 4 0 1)" fill="rgb(255,255,255)" stroke="none" stroke-width="1"/><g id="e8bu6x54hi373_to" transform="translate(0.070095,1)"><path id="e8bu6x54hi373" d="M5.126180,12.929700C4.786330,12.777300,4.616410,12.519500,4.616410,12.156200C4.616410,12.039100,4.639850,11.927700,4.686720,11.822300L9.626180,0.572266C9.661330,0.490234,9.702350,0.419922,9.749220,0.361328C9.807820,0.291016,9.872270,0.238281,9.942580,0.203125C10.012900,0.156250,10.083200,0.121094,10.153500,0.097656C10.235600,0.074219,10.317600,0.062500,10.399600,0.062500C10.516800,0.062500,10.628100,0.085938,10.733600,0.132812C11.073400,0.285156,11.243400,0.542969,11.243400,0.906250C11.243400,0.953125,11.237500,0.994141,11.225800,1.029300C11.225800,1.064450,11.219900,1.099610,11.208200,1.134770C11.196500,1.169920,11.184800,1.205080,11.173100,1.240230L6.233600,12.490200C6.198440,12.572300,6.151570,12.648400,6.092970,12.718800C6.046100,12.777300,5.987510,12.830100,5.917190,12.877000C5.846880,12.912100,5.770710,12.941400,5.688680,12.964800C5.618370,12.988300,5.542190,13,5.460160,13C5.342970,13,5.231650,12.976600,5.126180,12.929700Z" transform="scale(4,4) translate(0,0)" fill="rgb(255,255,255)" stroke="none" stroke-width="1"/></g><g id="e8bu6x54hi374_to" transform="translate(0,1)"><path id="e8bu6x54hi374" d="M9.162120,12.929700C8.822270,12.777300,8.652350,12.519500,8.652350,12.156200C8.652350,12.039100,8.675790,11.927700,8.722660,11.822300L13.662100,0.572266C13.697300,0.490234,13.738300,0.419922,13.785200,0.361328C13.843800,0.291016,13.908200,0.238281,13.978500,0.203125C14.048800,0.156250,14.119100,0.121094,14.189500,0.097656C14.271500,0.074219,14.353500,0.062500,14.435600,0.062500C14.552700,0.062500,14.664100,0.085938,14.769500,0.132812C15.109400,0.285156,15.279300,0.542969,15.279300,0.906250C15.279300,0.953125,15.273400,0.994141,15.261700,1.029300C15.261700,1.064450,15.255900,1.099610,15.244100,1.134770C15.232400,1.169920,15.220700,1.205080,15.209000,1.240230L10.269500,12.490200C10.234400,12.572300,10.187500,12.648400,10.128900,12.718800C10.082000,12.777300,10.023400,12.830100,9.953130,12.877000C9.882820,12.912100,9.806650,12.941400,9.724620,12.964800C9.654300,12.988300,9.578130,13,9.496100,13C9.378910,13,9.267580,12.976600,9.162120,12.929700Z" transform="scale(4,4) translate(0,0)" fill="rgb(255,255,255)" stroke="none" stroke-width="1"/></g></svg>');
      
      // load the checkout module then prep (loads CSS stuff so there's no lag when we open the window)
      vv.loadScript(vv.path + '/checkout/checkout.js', function () {
        vv.checkout.prep();
      });
      
      // allow for price customization
      vv.events.add(document.getElementById('input-price'),'change', function(e) {
        if (e.target.value > {{braintree.minimumCost}}) {
          checkoutOptions.amount = e.target.value;
          document.getElementById('checkout-price').innerHTML = e.target.value;
        } else {
          e.target.value = {{braintree.minimumCost}};
        }
      });
      
      // start the checkout process
      vv.events.add(document.getElementById('checkout'),'click', function(e) {
        e.preventDefault();
        vv.checkout.begin(checkoutOptions);
      });
      
      // handle the unsubscription flow
      vv.events.add(document.getElementById('cancelLink'),'click', function(e) {
        e.preventDefault();
        
        var container = document.createElement('div');
            container.id = 'unsubscribe-form-wrapper';
        var instructions = document.createElement('h2');
            instructions.innerHTML = 'Enter your email — we\'ll send you a cancel/unsubscribe link.';
        var unsubscribeForm = document.createElement('form');
            unsubscribeForm.method = 'POST';
            unsubscribeForm.action = '/unsubscribe';
            unsubscribeForm.id = 'unsubscribeForm';
        var emailInput = document.createElement('input');
            emailInput.type = 'email';
            emailInput.id = 'email';
            emailInput.name = 'email';
            emailInput.placeholder = 'you@email.com';
        var emailSubmit = document.createElement('input');
            emailSubmit.type = 'submit';
            emailSubmit.value = 'Unsubscribe';
        
        unsubscribeForm.appendChild(emailInput);
        unsubscribeForm.appendChild(emailSubmit);

        container.appendChild(instructions);
        container.appendChild(unsubscribeForm);
        
        vv.overlay.reveal(container.outerHTML);
      });
    });
  </script>
  
<!-- End Document
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  
</body>
</html>